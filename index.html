<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Monitoring Guru Piket</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .tab-active { border-bottom: 3px solid #2563eb; color: #2563eb; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-20">

    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 sticky top-0 z-50 shadow-md">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold uppercase tracking-wider leading-none">Guru Piket</h1>
                <p id="current-date" class="text-[10px] opacity-80 italic mt-1"></p>
            </div>
            <div id="selector-container" class="flex flex-col items-end">
                <label class="text-[9px] uppercase font-bold opacity-70 mb-1">Pilih Jam Pelajaran:</label>
                <select id="period-selector" onchange="changePeriod()" class="bg-blue-700 text-white text-sm font-bold p-2 rounded-lg border border-blue-500 focus:outline-none focus:ring-2 focus:ring-white">
                    <!-- Options generated by JS -->
                </select>
            </div>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-[64px] z-40">
        <div class="max-w-4xl mx-auto flex">
            <button onclick="switchTab('input')" id="tab-input" class="flex-1 py-3 text-sm font-bold tab-active transition-all">Input Kehadiran</button>
            <button onclick="switchTab('recap')" id="tab-recap" class="flex-1 py-3 text-sm font-bold text-slate-500 transition-all">Rekap Seluruh Jam</button>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto p-4 space-y-6">
        
        <!-- View Input Kehadiran -->
        <div id="view-input" class="space-y-6">
            <!-- Statistik Ringkas -->
            <section class="grid grid-cols-3 gap-3">
                <div class="bg-white p-3 rounded-xl border-l-4 border-green-500 card-shadow text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-bold">Hadir</p>
                    <p id="stat-hadir" class="text-xl font-bold text-green-600">0</p>
                </div>
                <div class="bg-white p-3 rounded-xl border-l-4 border-yellow-500 card-shadow text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-bold">Tugas</p>
                    <p id="stat-tugas" class="text-xl font-bold text-yellow-600">0</p>
                </div>
                <div class="bg-white p-3 rounded-xl border-l-4 border-red-500 card-shadow text-center">
                    <p class="text-[10px] text-gray-500 uppercase font-bold">Kosong</p>
                    <p id="stat-kosong" class="text-xl font-bold text-red-600">0</p>
                </div>
            </section>

            <!-- Daftar Kelas -->
            <section>
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold text-slate-700 flex items-center">
                        <span class="w-2 h-6 bg-blue-600 rounded mr-2"></span>
                        Kontrol Kelas
                    </h2>
                    <span id="label-jam-aktif" class="text-xs font-bold text-blue-600 bg-blue-50 px-3 py-1 rounded-full border border-blue-100"></span>
                </div>
                <div id="class-grid" class="grid gap-4"></div>
            </section>

            <!-- Tombol Aksi -->
            <section class="flex flex-col gap-3">
                <button onclick="copyReport()" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg active:scale-95 flex items-center justify-center">
                    Salin Laporan WA (Jam Ini)
                </button>
            </section>
        </div>

        <!-- View Rekap Seluruh Jam -->
        <div id="view-recap" class="hidden space-y-4">
            <div class="bg-white rounded-xl card-shadow overflow-hidden border border-slate-200">
                <div class="p-4 bg-slate-100 border-b border-slate-200 flex justify-between items-center">
                    <h3 class="font-bold text-slate-700">Tabel Rekapitulasi Global</h3>
                    <button onclick="copyFullDayReport()" class="bg-blue-600 text-white text-[10px] px-3 py-1 rounded font-bold hover:bg-blue-700 transition-colors">Salin Rekap Ketidakhadiran</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-[10px] text-left">
                        <thead class="bg-slate-50 text-slate-500 uppercase border-b border-slate-200">
                            <tr>
                                <th class="p-3 sticky left-0 bg-slate-50 z-10">Kelas</th>
                                <th class="p-3">J1</th>
                                <th class="p-3">J2</th>
                                <th class="p-3">J3</th>
                                <th class="p-3">J4</th>
                                <th class="p-3">J5</th>
                                <th class="p-3">J6</th>
                                <th class="p-3">J7</th>
                                <th class="p-3">J8</th>
                                <th class="p-3">J9</th>
                            </tr>
                        </thead>
                        <tbody id="recap-table-body" class="divide-y divide-slate-100">
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="p-4 bg-blue-50 border border-blue-100 rounded-xl">
                <p class="text-[10px] text-blue-700 font-semibold italic">Keterangan: ‚úÖ=Hadir, üìù=Tugas, ‚ùå=Kosong, ‚ö™=Belum Cek</p>
            </div>
            <button onclick="resetAllData()" class="w-full text-red-500 text-xs font-semibold py-4 border-2 border-red-100 rounded-xl bg-red-50">Hapus Seluruh Data Hari Ini</button>
        </div>

    </main>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full opacity-0 pointer-events-none transition-opacity duration-300 shadow-2xl text-sm z-[100]">
        Laporan disalin!
    </div>

    <script>
        const JADWAL = [
            { id: "J1", label: "07:30 - 08:10 (Upacara)", short: "Upacara" },
            { id: "J2", label: "08:10 - 08:50 (Jam ke-2)", short: "Jam 2" },
            { id: "J3", label: "08:50 - 09:30 (Jam ke-3)", short: "Jam 3" },
            { id: "J4", label: "09:50 - 10:30 (Jam ke-4)", short: "Jam 4" },
            { id: "J5", label: "10:30 - 11:10 (Jam ke-5)", short: "Jam 5" },
            { id: "J6", label: "11:10 - 11:50 (Jam ke-6)", short: "Jam 6" },
            { id: "J7", label: "11:50 - 12:30 (Jam ke-7)", short: "Jam 7" },
            { id: "J8", label: "13:10 - 13:50 (Jam ke-8)", short: "Jam 8" },
            { id: "J9", label: "13:50 - 14:30 (Jam ke-9)", short: "Jam 9" }
        ];

        const KELAS_LIST = [
            "X-TK 1", "X-TK 2", "X-TO 1", "X-TO 2", "X-TE 1", "X-TE 2", "X-LAS", "X-DKV",
            "XI-TITL", "XI-TJTL", "XI-TPTU", "XI-TSM", "XI-TKR", "XI-TEI", "XI-TOI", "XI-TMK", 
            "XII-TITL", "XII-TJTL", "XII-TPTU", "XII-TSM", "XII-LAS", "XII-TEI", "XII-TOI", "XII-TMK",
       
        ];

        let currentPeriodId = "J1";
        let masterData = {};

        function init() {
            const saved = localStorage.getItem('piket_master_v4');
            if (saved) {
                masterData = JSON.parse(saved);
            } else {
                initMasterData();
            }

            const selector = document.getElementById('period-selector');
            JADWAL.forEach(j => {
                const opt = document.createElement('option');
                opt.value = j.id;
                opt.innerText = j.label;
                selector.appendChild(opt);
            });

            document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            renderClasses();
            updateStats();
        }

        function initMasterData() {
            masterData = {};
            JADWAL.forEach(j => {
                masterData[j.id] = {};
                KELAS_LIST.forEach(k => {
                    masterData[j.id][k] = { status: 'none', note: '', guru: '', mapel: '' };
                });
            });
            saveData();
        }

        function switchTab(tab) {
            const viewInput = document.getElementById('view-input');
            const viewRecap = document.getElementById('view-recap');
            const tabInput = document.getElementById('tab-input');
            const tabRecap = document.getElementById('tab-recap');
            const selector = document.getElementById('selector-container');

            if (tab === 'input') {
                viewInput.classList.remove('hidden');
                viewRecap.classList.add('hidden');
                tabInput.classList.add('tab-active');
                tabRecap.classList.remove('tab-active');
                tabRecap.classList.add('text-slate-500');
                selector.style.visibility = "visible";
                renderClasses();
            } else {
                viewInput.classList.add('hidden');
                viewRecap.classList.remove('hidden');
                tabInput.classList.remove('tab-active');
                tabInput.classList.add('text-slate-500');
                tabRecap.classList.add('tab-active');
                selector.style.visibility = "hidden";
                renderRecapTable();
            }
        }

        function renderRecapTable() {
            const tbody = document.getElementById('recap-table-body');
            tbody.innerHTML = '';

            KELAS_LIST.forEach(kelas => {
                const row = document.createElement('tr');
                let rowHtml = `<td class="p-3 font-bold bg-white sticky left-0 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)] text-slate-700">${kelas}</td>`;
                
                JADWAL.forEach(j => {
                    const status = masterData[j.id][kelas].status;
                    let icon = '‚ö™';
                    if(status === 'Hadir') icon = '‚úÖ';
                    if(status === 'Tugas') icon = 'üìù';
                    if(status === 'Kosong') icon = '‚ùå';
                    rowHtml += `<td class="p-3 text-center border-l border-slate-50">${icon}</td>`;
                });
                
                row.innerHTML = rowHtml;
                tbody.appendChild(row);
            });
        }

        window.changePeriod = function() {
            currentPeriodId = document.getElementById('period-selector').value;
            renderClasses();
            updateStats();
        }

        function renderClasses() {
            const grid = document.getElementById('class-grid');
            grid.innerHTML = '';
            const currentPeriodData = masterData[currentPeriodId];
            document.getElementById('label-jam-aktif').innerText = JADWAL.find(j => j.id === currentPeriodId).label;

            KELAS_LIST.forEach(kelas => {
                const data = currentPeriodData[kelas];
                const card = document.createElement('div');
                card.className = `bg-white p-4 rounded-xl card-shadow border border-slate-200 transition-all ${data.status !== 'none' ? 'ring-2 ring-blue-500 border-transparent shadow-lg' : ''}`;
                
                let badge = 'bg-slate-100 text-slate-400';
                if(data.status === 'Hadir') badge = 'bg-green-100 text-green-700';
                if(data.status === 'Tugas') badge = 'bg-yellow-100 text-yellow-700';
                if(data.status === 'Kosong') badge = 'bg-red-100 text-red-700';

                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-lg font-bold text-slate-800">${kelas}</span>
                        <span class="text-[9px] font-bold px-2 py-1 rounded-full uppercase ${badge}">${data.status === 'none' ? 'BELUM' : data.status}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <input type="text" value="${data.mapel || ''}" onchange="updateField('${kelas}', 'mapel', this.value)" 
                            placeholder="Mata Pelajaran" class="text-xs p-2 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:outline-none focus:ring-1 focus:ring-blue-400">
                        <input type="text" value="${data.guru || ''}" onchange="updateField('${kelas}', 'guru', this.value)" 
                            placeholder="Nama Guru" class="text-xs p-2 bg-slate-50 border border-slate-200 rounded-lg focus:bg-white focus:outline-none focus:ring-1 focus:ring-blue-400">
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setStatus('${kelas}', 'Hadir')" class="py-2 text-[10px] font-bold rounded-lg border-2 ${data.status === 'Hadir' ? 'bg-green-600 text-white border-green-600' : 'text-green-600 border-green-100 bg-green-50'}">HADIR</button>
                        <button onclick="setStatus('${kelas}', 'Tugas')" class="py-2 text-[10px] font-bold rounded-lg border-2 ${data.status === 'Tugas' ? 'bg-yellow-500 text-white border-yellow-500' : 'text-yellow-600 border-yellow-100 bg-yellow-50'}">TUGAS</button>
                        <button onclick="setStatus('${kelas}', 'Kosong')" class="py-2 text-[10px] font-bold rounded-lg border-2 ${data.status === 'Kosong' ? 'bg-red-500 text-white border-red-500' : 'text-red-600 border-red-100 bg-red-50'}">KOSONG</button>
                    </div>
                    <input type="text" placeholder="Catatan..." onchange="updateField('${kelas}', 'note', this.value)" 
                        value="${data.note || ''}" class="mt-2 w-full text-[10px] p-1 border-b border-dashed border-slate-200 focus:outline-none">
                `;
                grid.appendChild(card);
            });
        }

        window.updateField = function(kelas, field, value) {
            masterData[currentPeriodId][kelas][field] = value;
            saveData();
            updateStats();
        }

        window.setStatus = function(kelas, status) {
            masterData[currentPeriodId][kelas].status = status;
            saveData();
            updateStats();
            renderClasses();
        }

        function saveData() {
            localStorage.setItem('piket_master_v4', JSON.stringify(masterData));
        }

        function updateStats() {
            const values = Object.values(masterData[currentPeriodId]);
            document.getElementById('stat-hadir').innerText = values.filter(v => v.status === 'Hadir').length;
            document.getElementById('stat-tugas').innerText = values.filter(v => v.status === 'Tugas').length;
            document.getElementById('stat-kosong').innerText = values.filter(v => v.status === 'Kosong').length;
        }

        window.copyReport = function() {
            const periodLabel = JADWAL.find(j => j.id === currentPeriodId).label;
            let report = `*LAPORAN GURU PIKET*\nüìÖ ${new Date().toLocaleDateString('id-ID')}\nüìå *${periodLabel}*\n\n`;
            let detail = "";
            KELAS_LIST.forEach(k => {
                const d = masterData[currentPeriodId][k];
                if(d.status !== 'none') {
                    const icon = d.status === 'Hadir' ? '‚úÖ' : (d.status === 'Tugas' ? 'üìù' : '‚ùå');
                    detail += `${icon} *${k}*: ${d.mapel || '-'} (${d.guru || '-'}) -> ${d.status}${d.note ? ' ['+d.note+']' : ''}\n`;
                }
            });
            showToast("Laporan jam ini disalin!");
            
            const el = document.createElement('textarea');
            el.value = report + (detail || "_Belum ada data._") + "\n_Sistem Digital Guru Piket_";
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
        }

        window.copyFullDayReport = function() {
            let report = `*REKAP KETIDAKHADIRAN GURU HARIAN*\nüìÖ ${new Date().toLocaleDateString('id-ID')}\n\n`;
            let totalIssues = 0;

            JADWAL.forEach(j => {
                let jamDetail = "";
                KELAS_LIST.forEach(k => {
                    const d = masterData[j.id][k];
                    // Hanya ambil status Kosong atau Tugas (guru tidak masuk)
                    if(d.status === 'Kosong' || d.status === 'Tugas') {
                        const icon = d.status === 'Kosong' ? '‚ùå' : 'üìù';
                        jamDetail += `   ${icon} *${k}*: ${d.mapel || 'Mapel -'} (${d.guru || 'Guru -'}) -> ${d.status}${d.note ? ' ['+d.note+']' : ''}\n`;
                        totalIssues++;
                    }
                });

                if (jamDetail) {
                    report += `üìå *${j.short}*\n${jamDetail}\n`;
                }
            });

            if(totalIssues === 0) {
                report += "_Alhamdulillah, hari ini seluruh guru hadir di semua kelas._\n";
            }

            report += `\n_Total kelas terkendala: ${totalIssues}_\n_Laporan Sistem Guru Piket Digital_`;
            
            const el = document.createElement('textarea');
            el.value = report;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            showToast("Rekap ketidakhadiran disalin!");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.remove('opacity-0');
            setTimeout(() => t.classList.add('opacity-0'), 2000);
        }

        window.resetAllData = function() {
            if(confirm("Hapus seluruh data piket hari ini secara permanen?")) {
                localStorage.removeItem('piket_master_v4');
                initMasterData();
                renderClasses();
                updateStats();
                switchTab('input');
            }
        }

        window.onload = init;
    </script>
</body>
</html>


